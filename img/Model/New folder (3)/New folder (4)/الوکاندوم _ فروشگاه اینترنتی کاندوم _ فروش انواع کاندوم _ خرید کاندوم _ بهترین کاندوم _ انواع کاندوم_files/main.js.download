jQuery(function ($) {
    $('form.woocommerce-checkout').on('change', 'select#billing_city', function () {
        // Set the select value in a variable
        var a = $(this).val();

        // Update checkout event
        $('body').trigger('update_checkout');

        // Restoring the chosen option value
        $('select#billing_city option[value=' + a + ']').prop('selected', true);

        // Once checkout has been updated
        $('body').on('updated_checkout', function () {
            // Restoring the chosen option value
            $('select#billing_city option[value=' + a + ']').prop('selected', true);
        });
    });
    $('form.woocommerce-checkout').on('change', 'select#billing_sabira_cities', function () {
        // Set the select value in a variable
        var a = $(this).val();

        // Update checkout event
        $('body').trigger('update_checkout');

        // Restoring the chosen option value
        $('select#billing_sabira_cities option[value=' + a + ']').prop('selected', true);

        // Once checkout has been updated
        $('body').on('updated_checkout', function () {
            // Restoring the chosen option value
            $('select#billing_sabira_cities option[value=' + a + ']').prop('selected', true);
        });
    });
    $('form.checkout').on('change', 'input[name^="payment_method"]', function () {
        $('body').trigger('update_checkout');
    });
    $(document).on('click', '#rt_acod_pre_payment',function () {
        var pre_payment = 0;
        if ($(this).is(':checked')) {
            pre_payment = $(this).val();
        }
        $.ajax(
            {
                type: 'POST',
                url: rt_ajax_vars.ajax_url,
                data: {
                    action: 'rt_acod_check_pre_payment',
                    rt_acod_pre_payment: pre_payment
                },
                success: function (response) {
                    $('body').trigger('update_checkout');
                }
            }
        )
    });
    $('body').on('update_checkout',function () {
        $.ajax(
            {
                type: 'POST',
                url: rt_ajax_vars.ajax_url,
                data: {
                    action: 'rt_acod_check_active_pre_payment',
                },
                success: function (response) {
                    if(response == 0) {
                        $('.rt_acod_pre_payment').remove();
                    }else{
                        if(! $('.rt_acod_pre_payment').length){
                            $('#payment').before(response);
                        }
                    }
                }
            }
        );
        removeCodONZero();
    });
    $(document.body).on('updated_checkout',function () {
        removeCodONZero();
    });
    $(document).ready(function () {
        removeCodONZero();
    });
    function removeCodONZero() {
        $('table.shop_table tr.fee').each(function () {
            var $this = $(this);
            var title = $this.find('th').text();
            if(title == 'پرداخت در محل' || title == 'Pay with Cod'){
                var priceText = $this.find('span.woocommerce-Price-amount.amount').text();
                var price = priceText.split('');
                if(price[0] == 0 || price[0] == '۰'){
                    $this.remove();
                }
            }
        });
    }
});